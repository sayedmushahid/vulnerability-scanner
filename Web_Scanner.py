import os
import threading
from urllib3.exceptions import InsecureRequestWarning
from colorama import Fore
import requests
from crawler import webCrawler, print_links

# Nikto Scan
def nikto_scan(target):
    nikto_commad = "nikto -host " + target
    os.system(nikto_commad)

def crawler(targetUrl , path):
    wc = webCrawler()
    hrefLink = wc.extract_links(targetUrl)
    print_links(hrefLink, targetUrl, path)

# Web Scanning Start
def web_scan(host, port, path):
    print(Fore.GREEN + "Scanning Web on " + port)
    target = host + ":" + port
    try:
        url = "http://" + target
        r = requests.get(url, allow_redirects=False)  # Request to Server
        if r.status_code != 200:  # Checking Response Code
            if r.status_code == 301:
                print(Fore.BLUE + "Skipping....! Website redirects to " + r.url)
                print(Fore.WHITE + "\n******************************************************")  # In case of redirect
            else:
                print("Website not working properly")
                print(
                    Fore.WHITE + "\n******************************************************")  # In case of someother port

        # If everything is fine
        else:
            crawler(url, path)
            # nikto_scan(target)


    except:
        try:
            requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)  # SSL Security Warning Bypass
            url = "https://" + target
            r = requests.get(url, verify=False)  # Request to Server
            if r.status_code != 200:  # Checking Response Code
                if r.status_code == 301:
                    print(Fore.BLUE + "Skipping....! Website redirects to " + r.url)
                    print(
                        Fore.WHITE + "\n******************************************************")  # In case of redirect
                else:
                    print("Webite not working properly")
                    print(
                        Fore.WHITE + "\n******************************************************")  # In case of someother port

            # If everything is fine
            else:
                crawler(url, path)
                # nikto_scan(target)

        except Exception as e:
            print(f'[-] ERROR: {e}')

